<!doctype html>
<html>
  <head>
    <title>Quick Storage Clear</title>
    <style>
      body {
        font-family: system-ui;
        max-width: 600px;
        margin: 50px auto;
        padding: 20px;
        background: #0a0a0a;
        color: #fff;
      }
      button {
        background: #ef4444;
        color: white;
        border: none;
        padding: 15px 30px;
        font-size: 16px;
        border-radius: 8px;
        cursor: pointer;
        margin: 10px;
      }
      button:hover {
        background: #dc2626;
      }
      .safe {
        background: #22c55e;
      }
      .safe:hover {
        background: #16a34a;
      }
      pre {
        background: #1a1a1a;
        padding: 15px;
        border-radius: 8px;
        overflow-x: auto;
      }
    </style>
  </head>
  <body>
    <h1>🚨 Emergency Storage Management</h1>

    <h2>Quick Actions</h2>
    <button class="safe" onclick="clearFavoritesOnly()">Clear Favorites Only</button>
    <button onclick="clearAllKV()">Clear ALL KV Storage</button>
    <button onclick="showCurrent()">Show Current Data</button>

    <h2>Current Storage:</h2>
    <div id="output"></div>

    <script>
      function clearFavoritesOnly() {
        localStorage.removeItem('kv:favorite-devices')
        alert('✅ Favorites cleared! Refresh your Dashboard.')
        showCurrent()
      }

      function clearAllKV() {
        if (confirm('⚠️ This will clear ALL KV data. Continue?')) {
          Object.keys(localStorage).forEach(key => {
            if (key.startsWith('kv:')) {
              localStorage.removeItem(key)
            }
          })
          alert('✅ All KV storage cleared! Refresh your Dashboard.')
          showCurrent()
        }
      }

      function showCurrent() {
        const output = document.getElementById('output')
        const kvKeys = Object.keys(localStorage).filter(k => k.startsWith('kv:'))

        let html = '<pre>'
        html += `Found ${kvKeys.length} KV keys:\n\n`

        kvKeys.forEach(key => {
          const value = localStorage.getItem(key)
          try {
            const parsed = JSON.parse(value)
            const type = Array.isArray(parsed) ? `Array[${parsed.length}]` : typeof parsed
            html += `<strong>${key}</strong>: ${type}\n`

            if (key === 'kv:favorite-devices') {
              html += `  IDs: ${JSON.stringify(parsed)}\n`
            }
            if (key === 'kv:devices' && Array.isArray(parsed)) {
              html += `  First 3 device IDs: ${parsed
                .slice(0, 3)
                .map(d => d.id)
                .join(', ')}\n`
            }
          } catch (e) {
            html += `<strong>${key}</strong>: ${value.substring(0, 50)}...\n`
          }
          html += '\n'
        })

        html += '</pre>'
        output.innerHTML = html
      }

      // Show on load
      showCurrent()
    </script>
  </body>
</html>
