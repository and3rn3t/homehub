<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Test Color Controls - HomeHub</title>
    <style>
      body {
        font-family:
          system-ui,
          -apple-system,
          sans-serif;
        max-width: 1200px;
        margin: 0 auto;
        padding: 20px;
        background: #f5f5f5;
      }
      .header {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        padding: 30px;
        border-radius: 12px;
        margin-bottom: 30px;
      }
      .test-section {
        background: white;
        padding: 25px;
        border-radius: 12px;
        margin-bottom: 20px;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
      }
      .test-section h3 {
        margin-top: 0;
        color: #667eea;
        border-bottom: 2px solid #667eea;
        padding-bottom: 10px;
      }
      .device-list {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
        gap: 15px;
        margin: 20px 0;
      }
      .device-card {
        background: #f8f9fa;
        border: 2px solid #e9ecef;
        border-radius: 8px;
        padding: 15px;
        cursor: pointer;
        transition: all 0.2s;
      }
      .device-card:hover {
        border-color: #667eea;
        box-shadow: 0 4px 8px rgba(102, 126, 234, 0.2);
        transform: translateY(-2px);
      }
      .device-card.extended-color {
        border-left: 4px solid #10b981;
      }
      .device-card.dimmable {
        border-left: 4px solid #f59e0b;
      }
      .device-name {
        font-weight: bold;
        color: #1f2937;
        margin-bottom: 5px;
      }
      .device-info {
        font-size: 0.875rem;
        color: #6b7280;
      }
      .capability-badge {
        display: inline-block;
        background: #e0e7ff;
        color: #4338ca;
        padding: 2px 8px;
        border-radius: 4px;
        font-size: 0.75rem;
        margin-right: 5px;
        margin-top: 5px;
      }
      .test-checklist {
        background: #f0f9ff;
        border-left: 4px solid #0ea5e9;
        padding: 15px;
        margin: 15px 0;
      }
      .test-checklist li {
        margin: 8px 0;
        line-height: 1.6;
      }
      .test-step {
        background: #fef3c7;
        border-left: 4px solid #f59e0b;
        padding: 15px;
        margin: 15px 0;
      }
      .success {
        background: #d1fae5;
        border-left: 4px solid #10b981;
        padding: 15px;
        margin: 15px 0;
      }
      .button {
        background: #667eea;
        color: white;
        border: none;
        padding: 12px 24px;
        border-radius: 8px;
        font-size: 1rem;
        cursor: pointer;
        transition: all 0.2s;
      }
      .button:hover {
        background: #5568d3;
        transform: translateY(-1px);
      }
      .button-secondary {
        background: #10b981;
      }
      .button-secondary:hover {
        background: #059669;
      }
      .stats {
        display: grid;
        grid-template-columns: repeat(3, 1fr);
        gap: 15px;
        margin: 20px 0;
      }
      .stat-card {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        padding: 20px;
        border-radius: 8px;
        text-align: center;
      }
      .stat-number {
        font-size: 2.5rem;
        font-weight: bold;
        margin: 10px 0;
      }
      .stat-label {
        font-size: 0.875rem;
        opacity: 0.9;
      }
    </style>
  </head>
  <body>
    <div class="header">
      <h1>🎨 Color Controls Testing Dashboard</h1>
      <p>Test your Hue device color controls, brightness, and temperature settings</p>
    </div>

    <div class="stats" id="stats">
      <div class="stat-card">
        <div class="stat-label">Total Devices</div>
        <div class="stat-number" id="totalDevices">0</div>
      </div>
      <div class="stat-card">
        <div class="stat-label">Extended Color</div>
        <div class="stat-number" id="colorDevices">0</div>
      </div>
      <div class="stat-card">
        <div class="stat-label">Dimmable</div>
        <div class="stat-number" id="dimmableDevices">0</div>
      </div>
    </div>

    <div class="test-section">
      <h3>📋 Pre-Test Checklist</h3>
      <div class="test-checklist">
        <ul>
          <li>✅ Vite dev server running on <strong>http://localhost:5173</strong></li>
          <li>✅ Hue Bridge accessible at <strong>192.168.1.6</strong></li>
          <li>✅ 22 Hue devices imported to localStorage</li>
          <li>✅ DeviceControlPanel component created</li>
          <li>✅ Dashboard and Rooms integration complete</li>
        </ul>
      </div>
      <button class="button" onclick="window.open('http://localhost:5173', '_blank')">
        🚀 Open HomeHub Dashboard
      </button>
    </div>

    <div class="test-section">
      <h3>🎮 Test Scenarios</h3>

      <div class="test-step">
        <strong>Test 1: Open Control Panel (Dashboard)</strong>
        <ol>
          <li>Navigate to Dashboard tab in HomeHub</li>
          <li>Scroll to "Favorite Devices" section</li>
          <li>Click on any device card (e.g., "Entry Interior")</li>
          <li>✅ Control panel should open with device name and controls</li>
        </ol>
      </div>

      <div class="test-step">
        <strong>Test 2: Brightness Control</strong>
        <ol>
          <li>Open control panel for "Entry Interior" (hue-59)</li>
          <li>Ensure device is powered ON</li>
          <li>Drag brightness slider to <strong>50%</strong></li>
          <li>✅ Physical light should dim to half brightness</li>
          <li>✅ Toast notification shows: "Brightness set to 50%" with response time</li>
          <li>Try 25%, 75%, 100% - verify smooth changes</li>
        </ol>
      </div>

      <div class="test-step">
        <strong>Test 3: Color Picker (Preset Buttons)</strong>
        <ol>
          <li>Open control panel for Extended Color device (e.g., "Matt's Table 2" - hue-39)</li>
          <li>Click the <strong>RED</strong> preset button</li>
          <li>✅ Light should turn red immediately</li>
          <li>✅ Toast shows: "Color set to #FF0000"</li>
          <li>Try other presets: Orange, Yellow, Green, Blue, Purple, Magenta</li>
        </ol>
      </div>

      <div class="test-step">
        <strong>Test 4: Color Picker (Hex Input)</strong>
        <ol>
          <li>In same device control panel</li>
          <li>Type <strong>#00FF00</strong> in hex input field</li>
          <li>Press Enter or click outside</li>
          <li>✅ Light should turn green</li>
          <li>Try: #FF00FF (magenta), #00FFFF (cyan), #FFFF00 (yellow)</li>
        </ol>
      </div>

      <div class="test-step">
        <strong>Test 5: Color Picker (Native Picker)</strong>
        <ol>
          <li>Click the small square color input on the right side</li>
          <li>OS-native color picker should open</li>
          <li>Select any color visually</li>
          <li>✅ Light should update to selected color</li>
        </ol>
      </div>

      <div class="test-step">
        <strong>Test 6: Color Temperature</strong>
        <ol>
          <li>Keep Extended Color device panel open</li>
          <li>Drag Color Temperature slider to <strong>2000K</strong> (left side - warm)</li>
          <li>✅ Light should glow warm orange/amber</li>
          <li>✅ Toast shows: "Color temperature set to 2000K"</li>
          <li>Drag to <strong>6500K</strong> (right side - cool)</li>
          <li>✅ Light should turn cool blue-white</li>
          <li>Try middle value: 4000K (neutral white)</li>
        </ol>
      </div>

      <div class="test-step">
        <strong>Test 7: Rename Device</strong>
        <ol>
          <li>In control panel, click pencil icon next to device name</li>
          <li>Type new name: <strong>"Test Light"</strong></li>
          <li>Press Enter or click Save</li>
          <li>✅ Name updates in control panel header</li>
          <li>Close panel and check Dashboard - name should be updated there too</li>
          <li>Rename back to original name for cleanup</li>
        </ol>
      </div>

      <div class="test-step">
        <strong>Test 8: Context Menu (Rooms Tab)</strong>
        <ol>
          <li>Navigate to <strong>Rooms</strong> tab</li>
          <li>Click on any room card to see devices</li>
          <li><strong>Right-click</strong> on a device mini-card in the grid</li>
          <li>✅ Control panel should open</li>
          <li><strong>Left-click</strong> same device (close panel first)</li>
          <li>✅ Device should toggle on/off (no panel)</li>
        </ol>
      </div>

      <div class="test-step">
        <strong>Test 9: Info Tab</strong>
        <ol>
          <li>Open any device control panel</li>
          <li>Click <strong>"Info"</strong> tab</li>
          <li>✅ Should show: Device ID, Type, Last Seen, Capabilities</li>
          <li>✅ If metadata present: Manufacturer, Model, Firmware</li>
          <li>✅ "Refresh State" button visible</li>
          <li>✅ "Remove Device" button visible (red)</li>
        </ol>
      </div>

      <div class="test-step">
        <strong>Test 10: Capability Detection</strong>
        <ol>
          <li>Open an <strong>Extended Color</strong> device (green border)</li>
          <li>✅ Should show: Brightness slider, Color picker, Color temp slider</li>
          <li>Open a <strong>Dimmable</strong> device (orange border)</li>
          <li>✅ Should show: Brightness slider only</li>
          <li>✅ Color picker hidden, Color temp hidden</li>
        </ol>
      </div>
    </div>

    <div class="test-section">
      <h3>💡 Your Hue Devices</h3>
      <p>Click any device to see its capabilities:</p>
      <div class="device-list" id="deviceList">
        <p style="color: #6b7280">Loading devices from localStorage...</p>
      </div>
    </div>

    <div class="test-section">
      <h3>✅ Expected Results</h3>
      <div class="success">
        <strong>All tests should show:</strong>
        <ul>
          <li>✅ Physical lights respond to all controls (brightness, color, temp)</li>
          <li>✅ UI updates immediately (optimistic updates)</li>
          <li>✅ Toast notifications appear with response times <100ms</li>
          <li>✅ Capability detection hides unsupported controls</li>
          <li>✅ Rename and delete work correctly</li>
          <li>✅ Context menu (right-click) works in Rooms tab</li>
          <li>✅ No console errors</li>
        </ul>
      </div>
    </div>

    <div class="test-section">
      <h3>🐛 Troubleshooting</h3>
      <div
        style="background: #fee2e2; border-left: 4px solid #ef4444; padding: 15px; margin: 15px 0"
      >
        <strong>If something doesn't work:</strong>
        <ol>
          <li><strong>No devices showing?</strong> Check localStorage has "kv:devices" key</li>
          <li><strong>Control panel won't open?</strong> Check browser console for errors</li>
          <li>
            <strong>Lights not responding?</strong> Verify Hue Bridge at 192.168.1.6 is accessible
          </li>
          <li><strong>Colors not changing?</strong> Ensure device has "color" capability</li>
          <li><strong>Toast not showing time?</strong> Check network tab for API calls</li>
        </ol>
      </div>
    </div>

    <script>
      // Load devices from localStorage
      function loadDevices() {
        try {
          const devicesJson = localStorage.getItem('kv:devices')
          if (!devicesJson) {
            document.getElementById('deviceList').innerHTML =
              '<p style="color: #ef4444;">❌ No devices found in localStorage. Please import Hue devices first.</p>'
            return
          }

          const devices = JSON.parse(devicesJson)

          // Update stats
          const hueDevices = devices.filter(d => d.protocol === 'hue')
          const extendedColor = hueDevices.filter(
            d =>
              d.capabilities?.includes('color') &&
              d.capabilities?.includes('dimming') &&
              d.capabilities?.includes('color-temp')
          )
          const dimmable = hueDevices.filter(
            d => d.capabilities?.includes('dimming') && !d.capabilities?.includes('color')
          )

          document.getElementById('totalDevices').textContent = hueDevices.length
          document.getElementById('colorDevices').textContent = extendedColor.length
          document.getElementById('dimmableDevices').textContent = dimmable.length

          // Render device list
          const deviceListHtml = hueDevices
            .map(device => {
              const hasColor = device.capabilities?.includes('color')
              const hasDimming = device.capabilities?.includes('dimming')
              const hasColorTemp = device.capabilities?.includes('color-temp')
              const cardClass = hasColor ? 'extended-color' : 'dimmable'

              return `
            <div class="device-card ${cardClass}">
              <div class="device-name">${device.name}</div>
              <div class="device-info">
                <div>${device.id}</div>
                <div style="margin-top: 8px;">
                  ${hasDimming ? '<span class="capability-badge">Brightness</span>' : ''}
                  ${hasColor ? '<span class="capability-badge">Color</span>' : ''}
                  ${hasColorTemp ? '<span class="capability-badge">Temp</span>' : ''}
                </div>
              </div>
            </div>
          `
            })
            .join('')

          document.getElementById('deviceList').innerHTML =
            deviceListHtml || '<p style="color: #6b7280;">No Hue devices found.</p>'
        } catch (err) {
          console.error('Error loading devices:', err)
          document.getElementById('deviceList').innerHTML =
            `<p style="color: #ef4444;">❌ Error loading devices: ${err.message}</p>`
        }
      }

      // Load on page load
      loadDevices()

      // Refresh button
      function refresh() {
        loadDevices()
        alert('✅ Devices refreshed from localStorage!')
      }

      // Add refresh button
      const header = document.querySelector('.header')
      const refreshBtn = document.createElement('button')
      refreshBtn.className = 'button button-secondary'
      refreshBtn.textContent = '🔄 Refresh Devices'
      refreshBtn.style.marginTop = '15px'
      refreshBtn.onclick = refresh
      header.appendChild(refreshBtn)
    </script>
  </body>
</html>
